---
title: How many women in New York are pregnant right now?
author:
date: "2018-01-16"
slug: nys-pregnancy
draft: true
tags:
  - rstats
  - mapping
  - census
---



<p>When I found out that J was pregnant, my first thought was OMG, I’m so excited to be a dad! My second thought was, I wonder <em>how many other women in New York are also pregnant right now?</em> Knowing that there was plenty of health and demographic public data available, I was pretty sure I could answer this question.</p>
<p>After a little googling, I found <a href="https://www.cdc.gov/reproductivehealth/emergency/pdfs/PregnacyEstimatoBrochure508.pdf">this brief</a> from the Centers for Disease Control and Prevention (CDC) which details how to estimate the number of pregnant women in a geographic area. Bingo!</p>
<p>To calculate the number of pregnant women in a given area, you need to specify four parameters:</p>
<ul>
<li>Number of women of reproductive age [WRA] (15 – 44 years old)</li>
<li>Fertility rate (live births per 1,000 WRA)</li>
<li>Abortion rate (induced abortions per 1,000 WRA)</li>
<li>Fetal loss rate (fetal deaths per 1,000 WRA)</li>
</ul>
<p>With these parameters, there is a very simple calculation to arrive at the total number of women who are pregnant. Given the following variables:</p>
<p><span class="math display">\[
\begin{aligned}
wra ={} &amp; \text{women of reproductive age}\\
b ={} &amp; \text{fertility rate (births)}\\
a ={} &amp; \text{abortion rate} \\
d ={} &amp; \text{fetal loss rate (deaths)} \\
P ={} &amp; \text{proportion of the year a woman} \\
      &amp; \text{is pregnant for each outcome} \\
      &amp; P_b\colon \text{ 9 months} = .75 \\
      &amp; P_a\colon \text{ 2 months} = .167 \\
      &amp; P_d\colon \text{ 3 months} = .25
\end{aligned}
\]</span></p>
<p>The expression to estimate the number of women who live in a given geographical area that are currently pregnant is:</p>
<p><span class="math display">\[
\begin{aligned}
wra/1000 \times ((b \times P_b) + (a \times P_a) + (d \times P_d))
\end{aligned}
\]</span></p>
<p>Following the CDC guidance, I determined the best and most recent sources of data for each of these parameters for New York State:</p>
<ul>
<li>NYS Department of Health Vital Statistics, 2015, <a href="https://www.health.ny.gov/statistics/vital_statistics/2015/table01a.htm">Table 1a</a></li>
<li>NYS Department of Health Vital Statistics, 2015, <a href="https://www.health.ny.gov/statistics/vital_statistics/2015/table07.htm">Table 7</a></li>
<li>NYS Department of Health Vital Statistics, 2015, <a href="https://www.health.ny.gov/statistics/vital_statistics/2015/table21.htm">Table 21</a></li>
<li>CDC National Vital Statistics Reports, <em>Estimated Pregnancy Rates and Rates of Pregnancy Outcomes for the United States</em>, 2012, <a href="https://www.cdc.gov/nchs/data/nvsr/nvsr60/nvsr60_07.pdf">Table 1</a></li>
</ul>
<p>The NYS Department of Health report this data at the county level, so I will calculate results for each of New York’s 62 counties.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> I will also use demographic data from the American Community Survey to contextulize the results.</p>
<p>Let’s get to it!</p>
<p>The first step is to scrape and clean the vital statistics data from the <a href="https://www.health.ny.gov/statistics/vital_statistics/2015/">NYS Department of Health website</a>.</p>
<pre class="r"><code>library(tidyverse)
library(rvest)

# nys health data lives here
health_web &lt;- &quot;https://www.health.ny.gov/statistics/vital_statistics/2015/&quot;

# each parameter lives in a table on a different page
pop &lt;- read_html(paste0(health_web, &quot;table01a.htm&quot;))
birth &lt;- read_html(paste0(health_web, &quot;table07.htm&quot;))
abort &lt;- read_html(paste0(health_web, &quot;table21.htm&quot;))</code></pre>
<pre class="r"><code># define a function to find and parse the table node,
# select the columns i need, and make it into a tibble
# thankfully, the table formatting is the same on each page
read_nys_xml_table &lt;- function(x) {
  html_nodes(x, &quot;table&quot;) %&gt;%
    html_table(fill = TRUE) %&gt;%
    as.data.frame() %&gt;%  # i&#39;m not sure why i can&#39;t coerce directly to tibble
    as_tibble() %&gt;%
    slice(-(c(1:5, 11:12)))
  }

# parse and clean population
population &lt;- read_nys_xml_table(pop) %&gt;%
  transmute(
    county = County,
    pop_wra = as.integer(str_replace(Var.2, &quot;,&quot;, &quot;&quot;))
    ) %&gt;%
  # combine essex/hamilton counties
  add_row(
    county = &quot;Essex/Hamilton&quot;,
    pop_wra = sum(.$pop_wra[.$county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;)])
    ) %&gt;%
  filter(!county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;))

# parse and clean live births
live_births &lt;- read_nys_xml_table(birth) %&gt;%
  transmute(
    county = County,
    live_births = as.integer(str_replace(Var.2, &quot;,&quot;, &quot;&quot;))
    ) %&gt;%
  # combine essex/hamilton counties
  add_row(
    county = &quot;Essex/Hamilton&quot;,
    live_births = sum(.$live_births[.$county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;)])
    ) %&gt;%
  filter(!county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;))

# parse and clean abortions
abortions &lt;- read_nys_xml_table(abort) %&gt;%
  transmute(
    county = County,
    abortions = as.integer(str_replace(Var.2, &quot;,&quot;, &quot;&quot;))
    ) %&gt;%
  # essex/hamilton is already aggregated here, but repeated as hamilton/essex
  filter(county != &quot;Hamilton/Essex&quot;)

# let&#39;s print one of those tibbles to make sure it looks right
live_births</code></pre>
<pre><code>## # A tibble: 61 x 2
##    county      live_births
##    &lt;chr&gt;             &lt;int&gt;
##  1 Bronx             21130
##  2 Kings             41514
##  3 New York          17775
##  4 Queens            30335
##  5 Richmond           5286
##  6 Albany             3161
##  7 Allegany            496
##  8 Broome             1972
##  9 Cattaraugus         880
## 10 Cayuga              716
## # ... with 51 more rows</code></pre>
<p>Now that I’ve got all the Department of Health data cleaned up, I’ll join the raw numbers for population, births and abortions into one tibble and calculate rates per 1,000 women of reproductive age for births and abortions. I’m also adding the national fetal loss rate of 17.9 per 1,000 women of reproductive age to each county.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> After I join all the paramters, I can calculate the pregnancy rate using the expression specified above.</p>
<pre class="r"><code># join scarped data, calculate rates and total pregnant women
preg_rate &lt;- reduce(list(population, live_births, abortions), left_join) %&gt;%
  mutate(
    fertility_rate = (live_births / pop_wra) * 1000,
    abortion_rate = (abortions / pop_wra) * 1000,
    fetal_loss_rate = 17.9, # national rate per cdc
    preg_tot = as.integer((pop_wra / 1000) *
                            (
                              (fertility_rate * 0.75)
                              + (abortion_rate * 0.167)
                              + (fetal_loss_rate * 0.25)
                              )
                          )
    ) %&gt;%
  # rename to join with census data later
  mutate(county = recode(county, &quot;St Lawrence&quot; = &quot;St. Lawrence&quot;))
preg_rate</code></pre>
<pre><code>## # A tibble: 61 x 8
##    county      pop_wra live_births abortions fertility_rate abortion_rate
##    &lt;chr&gt;         &lt;int&gt;       &lt;int&gt;     &lt;int&gt;          &lt;dbl&gt;         &lt;dbl&gt;
##  1 Bronx        326993       21130     14992           64.6         45.8 
##  2 Kings        606681       41514     18026           68.4         29.7 
##  3 New York     418799       17775     10294           42.4         24.6 
##  4 Queens       496216       30335     13681           61.1         27.6 
##  5 Richmond      92426        5286      1634           57.2         17.7 
##  6 Albany        66574        3161      1139           47.5         17.1 
##  7 Allegany       9001         496        36           55.1          4.00
##  8 Broome        37951        1972       690           52.0         18.2 
##  9 Cattaraugus   13631         880        79           64.6          5.80
## 10 Cayuga        13223         716       139           54.1         10.5 
## # ... with 51 more rows, and 2 more variables: fetal_loss_rate &lt;dbl&gt;,
## #   preg_tot &lt;int&gt;</code></pre>
<p>Next up we’ll download county-level demographic data from the American Community Survey (ACS) using the wonderful <a href="https://walkerke.github.io/tidycensus/"><code>tidycensus</code></a> package. This package gives you easy access to Census API and as a bonus has the option to download TIGER/Line shapefiles and convert them to <a href="https://github.com/r-spatial/sf"><code>sf</code></a> objects containing population estimates. With the addition of the county geometry data, I can do some mapping to see if pregnancy rate appears to be related to</p>
<p>If you haven’t used <code>tidycensus</code> before, the first step after installing the package is to set a Census API key. A key can be requesed here: <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a>. To install the key in your <code>.Renviron</code> file simply run the following:</p>
<pre class="r"><code>library(tidycensus)
census_api_key(&quot;YOUR API KEY GOES HERE&quot;)</code></pre>
<p>For now, I’m just going to download the total population and total female population of each county. (In a later blog post, I’ll do some additional analysis using more sociodemographic variables to model the pregnancy rates.)</p>
<pre class="r"><code># cache downloaded shapefiles so don&#39;t have to re-download each time
options(tigris_use_cache = TRUE)

# download acs 5 year estimates
acs_pop &lt;- get_acs(
  state = &quot;NY&quot;,
  geography = &quot;county&quot;,
  variables = &quot;B01001_026&quot;,  # female pop
  survey = &quot;acs5&quot;,
  summary_var = &quot;B01001_001&quot;,  # total pop
  year = 2016,
  geometry = TRUE
)

# clean up county names for joining and rename vars
fem_pop &lt;- acs_pop %&gt;%
  mutate(county = str_replace(NAME, &quot;\\ County.*&quot;, &quot;&quot;)) %&gt;%
  select(county, pop_tot = summary_est, pop_fem = estimate)

# calculate combined populations for essex and hamilton counties
esx_ham &lt;- fem_pop %&gt;%
  filter(county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;)) %&gt;%
  summarise(
    county = &quot;Essex/Hamilton&quot;,
    pop_tot = sum(pop_tot),
    pop_fem = sum(pop_fem)
  )</code></pre>
<p>Now I’ll join the Census variables and geographies with the rates I caclulated from the NYS Department of Health to create one final data frame with everything I need to summarize and map the results.</p>
<pre class="r"><code># add essex/hamilton row and join with dept of health rates
# calc pregnant women as a proportion of female pop, total pop, and wra pop
preg_sf &lt;- rbind(fem_pop, esx_ham) %&gt;%
  filter(!county %in% c(&quot;Essex&quot;, &quot;Hamilton&quot;)) %&gt;%
  left_join(preg_rate) %&gt;% 
  mutate(
    preg_fem_prop = preg_tot / pop_fem,
    preg_wra_prop = preg_tot / pop_wra,
    preg_tot_prop = preg_tot / pop_tot
  )</code></pre>
<p>If you’ve never worked with an <code>sf</code> object before, it is essentially just a tibble with an additional column specifying the coordinates of the geometry associated with each row. So in this case, each row is a county and the <code>geometry</code> column is a list-column of XY coordinates that specify the shape of each county polygon.</p>
<p>An <code>sf</code> object prints like a tibble, but it includes some additional information relating to the geometry at the top.</p>
<pre class="r"><code># select first 4 cols for better printing
preg_sf %&gt;% select(1:4)</code></pre>
<pre><code>## Simple feature collection with 61 features and 4 fields
## geometry type:  GEOMETRY
## dimension:      XY
## bbox:           xmin: -79.76215 ymin: 40.4961 xmax: -71.85621 ymax: 45.01585
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs
## First 10 features:
##         county pop_tot pop_fem pop_wra                       geometry
## 1     Delaware   46480   23124    7341 MULTIPOLYGON (((-75.42264 4...
## 2    Jefferson  117966   56212   22780 MULTIPOLYGON (((-76.14753 4...
## 3   Livingston   64622   32183   12556 MULTIPOLYGON (((-78.06075 4...
## 4      Madison   72089   36660   13837 MULTIPOLYGON (((-75.99243 4...
## 5       Nassau 1356801  698640  248449 MULTIPOLYGON (((-73.49097 4...
## 6       Oneida  232858  116831   41260 MULTIPOLYGON (((-75.88676 4...
## 7       Oswego  120513   60129   22725 MULTIPOLYGON (((-76.61693 4...
## 8       Otsego   60979   31462   12291 MULTIPOLYGON (((-75.41693 4...
## 9      Suffolk 1498130  760779  275010 MULTIPOLYGON (((-72.03683 4...
## 10 Cattaraugus   78506   39711   13631 MULTIPOLYGON (((-79.05921 4...</code></pre>
<p>I’ve got the data cleaned up and I’ve calculated all the rates and proportions we need, so now I can do some exploring and mapping. First, I’ll look at raw numbers of pregnant women, since that was my initial question.</p>
<pre class="r"><code>preg_sf %&gt;% summarize(total_preg = sum(preg_tot))</code></pre>
<pre><code>## Simple feature collection with 1 feature and 1 field
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -79.76215 ymin: 40.4961 xmax: -71.85621 ymax: 45.01585
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs
##   total_preg                       geometry
## 1     209474 MULTIPOLYGON (((-74.25609 4...</code></pre>
<pre class="r"><code>ggplot(preg_sf, aes(x = reorder(county, preg_wra_prop), y = preg_wra_prop)) +
  geom_col(color = &quot;navy&quot;, width = 0.1) +
  geom_point(color = &quot;navy&quot;, size = 1.5) +
  labs(
    title = &quot;Percentage of women of reproductive age (15 – 44) who are pregnant&quot;,
    subtitle = &quot;by County in New York State&quot;,
    y = &quot;Percent Pregnant&quot;,
    x = &quot;&quot;,
    caption = paste(&quot;Source: NYS Department of Health Vital Statistics,&quot;,
                    &quot;2015, Tables 1a, 7, and 21\nCDC National Vital&quot;, 
                    &quot;Statistics, Pregnancy Outcomes for the United States,&quot;,
                    &quot;2008, Table 1&quot;
                     )
  ) +
  theme_bw() +
  theme(
    axis.text.x = element_text(size = 7, angle = 60, vjust = 0.5),
    plot.caption = element_text(size = 6, face = &quot;italic&quot;)
    ) +
  scale_y_continuous(labels = scales::percent)</code></pre>
<p><img src="/blog/2018-01-16-nys-pregnancy_files/figure-html/plot-1.png" width="1260" /></p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Due to the small number of abortions in Essex and Hamilton Counties, the NYS Department of Health reports combined numbers for these counties to protect privacy. Therefore, I aggregate all rates and calculations for these two counties.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>The CDC recommend that that national fetal loss rate be used as the rate does not vary systematically by geography and the CDC national estimate is likely more accurate than state Deaprtments of Health esitmates.<a href="#fnref2">↩</a></p></li>
</ol>
</div>
